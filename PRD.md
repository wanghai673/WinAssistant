# Windows 智能语音助手 · PRD（简洁版）

## 1. 背景与目标

- **目标**：提供一个在 Windows 上可“唤醒 → 对话 → 执行工具”的语音助手，降低用户跨应用操作成本，提升检索与自动化效率。
- **核心价值**：免切换窗口、免键鼠搜索；用自然语言完成常见电脑操作与信息查询。
- **版本范围（V1/MVP）**：可靠唤醒、流式语音交互、LLM 工具调用、可视化对话框（可关闭/置顶）、基础权限确认与离线兜底。

## 2. 用户与场景

- **用户画像**

  - 上班族/学生：需要快速查资料、开应用、记笔记。
  - 轻度技术用户：期望用口令完成系统控制（定时关机、截图、切网络等）。

- **代表性场景**

  1. “小智小智，打开 PowerPoint 并新建演示文稿。”
  2. “把剪贴板内容总结成 3 点发给我（仅显示，不真正发送）。”
  3. “我在看网页，帮我概括当前页面标题和要点。”
  4. “开麦说一下今天待办，并设提醒。”

## 3. 目标与非目标

- **Must（V1 必须）**

  - 唤醒词 + 热键唤醒；对话框弹出并录音。
  - 语音转写（ASR）流式显示，TTS 播报可打断。
  - 将用户话术发给 LLM，支持**函数/工具调用**（本地/系统/API）。
  - 对话框文本回复、手动关闭、置顶显示。
  - 高风险操作前弹出权限确认。
  - 离线可用：ASR/小模型或“仅工具模式”降级。

- **Should（V1.1 可选）**

  - 自动注入上下文（前台窗口标题、剪贴板）。
  - 工具调用轨迹与错误可视化。

- **Won’t（非目标，未来考虑）**

  - 跨设备连续对话、手机端镜像；多人同时说话识别；复杂自动化编排。

## 4. 成功指标（KPI/验收门槛）

- **首句到首字显示** ≤ 800ms（ASR partial）。
- **端到端响应**（话说完到开始播报）P50 ≤ 1.5s，P90 ≤ 2.5s（在线模式）。
- **唤醒准确率** FAR ≤ 1/小时，FRR ≤ 10%（安静室内）。
- **工具成功率** ≥ 95%（Top 5 工具）。
- **崩溃/致命错误率** ≤ 0.1% 会话。

## 5. 关键用户流程（高层）

1. **唤醒**：唤醒词或全局热键 → 弹出“语音条/对话框”→ 开始录音（VAD/AEC）。
2. **识别**：ASR 流式转写（显示 partial）→ 端点检测结束。
3. **理解&执行**：LLM 接收转写 + 上下文 → 可能触发**工具调用**

   - 若高风险 → 权限确认弹窗 → 执行或取消。

4. **回复**：对话框滚动显示文本；TTS 流式播报；用户开口可**打断**。
5. **收尾**：用户手动关闭或自动收起；日志与指标记录。

## 6. 功能需求（分项）

### 6.1 语音与交互

- 唤醒词（本地热词引擎）与可配置**全局热键**（Push-to-Talk）。
- 录音指示、能量条、实时转写；麦克风静音/切换设备。
- 朗读时**可打断**（Barge-in）；系统音量“轻度压低”（ducking）。

### 6.2 对话与工具

- LLM 对话（流式增量输出），支持函数/工具调用（JSON Schema）。
- **内置工具（V1）**：

  - `open_app(name)` 打开应用
  - `summarize_clipboard()` 概括剪贴板文本
  - `search_web(query)` 基础网页搜索并摘要（仅展示）
  - `control_system(action,target)`（如音量、Wi-Fi 开关、关机倒计时）

- 权限分级：只读（免确认）/改设置（需确认）/外部通信（V1 仅展示示意）。
- 上下文注入：前台窗口标题、剪贴板文本（用户可在设置里关闭）。

### 6.3 UI/UX

- 置顶可拖拽的**对话卡片**（浅色/深色、毛玻璃风格），支持复制内容、清空记录、手动关闭。
- 托盘菜单：网络/离线模式切换、设备选择、日志入口、退出。
- 错误提示友好（网络中断、ASR/LLM 不可用 → 自动降级提示）。

### 6.4 设置与隐私

- 本地/云处理指示与一键“离线模式”。
- 配置与短期记忆**本地加密**存储（Windows DPAPI）。
- 明确“高风险操作需要确认”，默认关闭“自动执行”。

### 6.5 性能与可靠性

- 音频：16kHz 单声道，20–30ms 帧；AEC（回声消除）启用。
- 断网降级：本地 ASR（Whisper）+ 仅文本回复；工具仍可执行本地动作。
- 启动自检：麦克风/扬声器、网络、模型可用性。

## 7. 非功能需求

- **平台**：Windows 10/11（x64），权限：麦克风、网络。
- **资源**：内存占用 ≤ 800MB（在线模式），CPU/GPU 可配置限速。
- **安全**：最小权限运行；工具沙箱与可审计日志。

## 8. 依赖与技术栈（建议）

- **路线 A（.NET）**：WinUI3/WPF + NAudio(WASAPI) + WebRTC AEC + Azure Speech（云）/Whisper 本地 + 任意 OpenAI 兼容 LLM SDK；PowerShell/WinAPI 执行工具。
- **路线 B（Python）**：PySide6 + sounddevice + webrtcvad + py-webrtc-audio-processing(AEC) + faster-whisper + edge-tts/coqui + openai/llama-cpp；pywin32/pywinauto 执行工具。

## 9. 发布范围（里程碑）

- **V1.0（MVP，4–6 周）**

  - 唤醒词+热键、对话框、ASR/TTS 流式、LLM+3 个工具、权限确认、离线降级。

- **V1.1**

  - 上下文注入（前台窗口/剪贴板）、日志面板、错误自诊断。

- **V1.2**

  - 多语种、记忆开关、更多系统工具（窗口管理/截图/录屏）。

## 10. 验收用例（摘选）

- **UC-01 唤醒并询问**：说出唤醒词 → 1s 内对话框出现且开始转写。
- **UC-02 打开应用**：说“打开计算器” → 权限不需确认 → 2s 内计算器在前台。
- **UC-03 高风险确认**：说“5 分钟后关机” → 弹出确认 → 点击允许才执行。
- **UC-04 Barge-in**：助手播报时再次讲话 → 播报即时停止并进入聆听。
- **UC-05 离线模式**：断网 → 提示降级 → 继续完成“打开记事本”。

## 11. 风险与缓解

- **误唤醒**：双通道（热词+热键）、环境自校准阈值、夜间静音策略。
- **回声导致自触发**：启用 AEC + TTS 播报时 ducking。
- **延迟超标**：流式链路、较小 ASR 模型、预热会话、并行工具查询。
- **工具越权**：默认禁用高风险，细粒度白名单与审计。

## 12. 追踪与度量

- 事件日志：唤醒 →ASR→LLM→ 工具 →TTS 时间戳；错误码。
- 指标面板：误唤醒率、端到端时延、工具成功率、降级次数。

## 13. 开放问题（待决策）

- 统一 TTS 声线与品牌提示音设计。
- 是否支持多轮长对话的“短期记忆”与过期策略。
- Web 搜索是否落地到具体供应商与合规策略。

---

### 附：MoSCoW 优先级列表（V1）

- **Must**：唤醒词/热键、流式 ASR/TTS、LLM 工具调用、权限确认、对话框可关闭、离线降级。
- **Should**：上下文注入、错误面板、托盘菜单。
- **Could**：主题皮肤、多语种、可插拔工具市场。
- **Won’t**：跨设备连续对话、IM 自动发送（V1 仅展示不发送）。

> 这份 PRD 用来指导 MVP 到 V1.2 的实现与验收。需要我把“工具清单的 JSON Schema 示例”和“.NET 或 Python 的目录脚手架”也补上一版吗？
